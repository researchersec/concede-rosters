<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>Generate Rosters</title>
</head>
<body class="bg-dark text-white">
    <div class="container mt-5">
    <!-- Button to Generate Rosters -->
    <button id="generateBtn" class="btn btn-dark">Generate Rosters</button>
    <input type="number" id="numRosters" name="numRosters" min="1" placeholder="Number of Rosters" value="1" class="form-control" style="width: 150px; display: inline-block;">

    <!-- Display Rosters -->
    <div id="rosters"></div>

    <!-- Display Players not belonging to a roster -->
    <div id="remainingPlayers"></div>

    <!-- JavaScript to Load Data, Generate and Display Rosters -->
    <script>
    document.getElementById('generateBtn').addEventListener('click', async function () {
        const numRosters = document.getElementById('numRosters').value || 1;

        const response = await fetch('players.json');
        const players = await response.json();

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateRosters(players, numRosters) {
            const tank_classes = ['Prot Warrior', 'Prot Paladin', 'Feral Druid Tank', 'Blood DK Tank'];
            const healer_classes = ['Holy Paladin', 'Disc Priest', 'Holy Priest', 'Resto Druid', 'Resto Shaman'];
            const all_added_combinations = new Set(); // Changed from all_added to all_added_combinations

            let rosters = [];

            for (let i = 0; i < numRosters; i++) {
                let roster = [];

                let tanks = shuffle(players.filter(player => tank_classes.includes(player.class) && !all_added_combinations.has(player.name + '-' + player.class)));
                let healers = shuffle(players.filter(player => healer_classes.includes(player.class) && !all_added_combinations.has(player.name + '-' + player.class)));
                let dps = shuffle(players.filter(player => !tank_classes.includes(player.class) && !healer_classes.includes(player.class) && !all_added_combinations.has(player.name + '-' + player.class)));

                while (roster.length < 2 && tanks.length > 0) {
                    const tank = tanks.shift();
                    roster.push(tank);
                    all_added_combinations.add(tank.name + '-' + tank.class);
                }

                while (roster.length < 4 && healers.length > 0) {
                    const healer = healers.shift();
                    roster.push(healer);
                    all_added_combinations.add(healer.name + '-' + healer.class);
                }

                while (roster.length < 10 && dps.length > 0) {
                    const dp = dps.shift();
                    roster.push(dp);
                    all_added_combinations.add(dp.name + '-' + dp.class);
                }

                roster = shuffle(roster);
                rosters.push(roster);
            }

            const remaining_players = players.filter(player => !all_added_combinations.has(player.name + '-' + player.class));
            return { rosters, remaining_players };
        }

        const { rosters, remaining_players } = generateRosters(players, numRosters);

        document.getElementById('rosters').innerHTML = '';
        document.getElementById('remainingPlayers').innerHTML = '';

        rosters.forEach((roster, index) => {
            const rosterDiv = document.createElement('div');
            let tableHTML = `<strong>Roster ${index + 1}:</strong><br>`;
            tableHTML += `<table class="table table-dark table-striped"><tbody>`;
            for (let i = 0; i < 5; i++) {
                tableHTML += `
                <tr>
                    <td><img src="${roster[i].url}" style="width:30px;height:30px;"/></td>
                    <td>${roster[i].name} - ${roster[i].class}</td>
                    <td><img src="${roster[i + 5].url}" style="width:30px;height:30px;"/></td>
                    <td>${roster[i + 5].name} - ${roster[i + 5].class}</td>
                </tr>`;
            }
            tableHTML += `</tbody></table>`;
            rosterDiv.innerHTML = tableHTML;
            document.getElementById('rosters').appendChild(rosterDiv);
        });

        const remainingDiv = document.createElement('div');
        remainingDiv.innerHTML = '<strong>Players not belonging to a roster:</strong><br>';
        remaining_players.forEach(player => {
            remainingDiv.innerHTML += `<p><img src="${player.url}" style="width:30px;height:30px;"/> ${player.name} - ${player.class}</p>`;
        });
        document.getElementById('remainingPlayers').appendChild(remainingDiv);
    });
</script>
    </div>
</body>
</html>
