<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>Generate Rosters</title>
    <style>
    .table td { padding: 0.25rem; }
    .custom-table { margin: 20px; width: 100%; }
    .custom-col {
        margin-right: 15px;
    }
</style>
</head>
<body class="bg-dark text-white">
    <div class="container mt-5">
    <!-- Button to Generate Rosters -->
    <button id="generateBtn" class="btn btn-dark">Generate Rosters</button>
    <input type="number" id="numRosters" name="numRosters" min="1" placeholder="Number of Rosters" value="1" class="form-control" style="width: 150px; display: inline-block;">

    <!-- Display Rosters -->
    <div id="rosters" class="row">
        <div class="col-sm me-3"></div>
    </div>

    <!-- Display Players not belonging to a roster -->
    <div id="remainingPlayers" class="row">
        <div class="col-sm me-3"></div>
    </div>

    <!-- JavaScript to Load Data, Generate and Display Rosters -->
    <script>
    document.getElementById('generateBtn').addEventListener('click', async function () {
    const numRosters = document.getElementById('numRosters').value || 1;

    // Load the player data from the uploaded JSON file
    const response = await fetch('players.json');
    const players = await response.json();

    function generateRosters(players, numRosters) {
        const tank_classes = ['Prot Warrior', 'Prot Paladin', 'Feral Druid Tank', 'Blood DK Tank'];
        const healer_classes = ['Holy Paladin', 'Disc Priest', 'Holy Priest', 'Resto Druid', 'Resto Shaman'];
        const all_added_players = new Set();

        let rosters = [];

        for (let i = 0; i < numRosters; i++) {
            let roster = [];
            let local_added_players = new Set();

            let available_players = players.filter(player => !all_added_players.has(player.name));

            let tanks = available_players.filter(player => tank_classes.includes(player.class));
            let healers = available_players.filter(player => healer_classes.includes(player.class));
            let dps = available_players.filter(player => !tank_classes.includes(player.class) && !healer_classes.includes(player.class));

            while (roster.length < 2 && tanks.length > 0) {
                const tank = tanks.shift();
                roster.push(tank);
                local_added_players.add(tank.name);
                all_added_players.add(tank.name);
            }

            while (roster.length < 4 && healers.length > 0) {
                const healer = healers.shift();
                roster.push(healer);
                local_added_players.add(healer.name);
                all_added_players.add(healer.name);
            }

            while (roster.length < 10 && dps.length > 0) {
                const dp = dps.shift();
                roster.push(dp);
                local_added_players.add(dp.name);
                all_added_players.add(dp.name);
            }

            rosters.push(roster);
        }

        return rosters;
    }

    // Call the function to generate rosters and pass the players data and numRosters
    const rosters = generateRosters(players, numRosters);

    // Clear previous rosters
    document.getElementById('rosters').innerHTML = '';

    // Display the generated rosters
    rosters.forEach((roster, index) => {
        const rosterDiv = document.createElement('div');
        rosterDiv.innerHTML = `<strong>Roster ${index + 1}:</strong><br>`;
        roster.forEach(player => {
            if (player !== null) {
                rosterDiv.innerHTML += `
                <div class="mb-2">
                    <img src="${player.url}" style="width:30px;height:30px;"/> 
                    ${player.name} - ${player.class}
                </div>`;
            }
        });
        document.getElementById('rosters').appendChild(rosterDiv);
    });

        document.getElementById('remainingPlayers').innerHTML = '';
        const remainingDiv = document.createElement('div');
        remainingDiv.classList.add('custom-col');
        let remainingHTML = '<strong>Players not belonging to a roster:</strong><br>';
        remainingHTML += `<table class="table table-dark table-striped custom-table"><tbody>`;
        remaining_players.forEach(player => {
            remainingHTML += `
            <tr>
                <td><img src="${player.url}" style="width:30px;height:30px;"/></td>
                <td><strong>${player.name}</strong></td>
            </tr>`;
        });
        remainingHTML += `</tbody></table>`;
        remainingDiv.innerHTML = remainingHTML;
        document.getElementById('remainingPlayers').appendChild(remainingDiv);
        });
</script>
    </div>
</body>
</html>
